# CodeQL Configuration for ExcelMcp
# Defines security scanning rules and exclusions
# Version: 3.0 - Comprehensive COM interop pattern suppressions
#
# Summary of Intentional Exclusions:
# - cs/catch-of-all-exceptions: COM requires broad exception handling
# - cs/empty-catch-block: Cleanup must not fail operations
# - cs/call-to-gc: Required for COM resource management
# - cs/nested-if-statements: Complex validation requires nested conditions
# - cs/dereferenced-value-may-be-null: Custom validation patterns
# - cs/useless-upcast: COM dynamic types require explicit casts
# - cs/invalid-dynamic-call: COM interop uses dynamic extensively
#
# See CODEQL-FIXES-SUMMARY.md for detailed rationale

name: "ExcelMcp CodeQL Configuration v3.0"

# Disable default query suite and use custom ones
disable-default-queries: false

# Query packs to run
queries:
  # Built-in security queries
  - uses: security-and-quality
  - uses: security-extended

# Paths to exclude from analysis
paths-ignore:
  - '**/bin/**'
  - '**/obj/**'
  - '**/packages/**'
  - '**/.nuget/**'
  - '**/node_modules/**'
  - '**/*.Designer.cs'
  - '**/*.g.cs'
  - '**/*.g.i.cs'
  - '**/AssemblyInfo.cs'
  - '**/TemporaryGeneratedFile_*.cs'

# Paths to explicitly include
paths:
  - 'src/**'
  - 'tests/**'

# Query filters - TEMPORARILY DISABLED to see all real issues
# Will re-enable targeted suppressions after fixing legitimate bugs
query-filters: []

# SUPPRESSED RULES (to be re-added selectively after cleanup):
# - cs/invalid-dynamic-call: COM interop dynamic calls (20 errors - false positive)
# - cs/call-to-gc: Explicit GC for COM cleanup (66 warnings - intentional)
# - cs/catch-of-all-exceptions: Need to audit - some legitimate, some not (1,349)
# - cs/empty-catch-block: Need to audit - some legitimate COM cleanup, some bugs (162)
# - cs/path-combine: Test code path handling (463)
# - Style suggestions: nested-if, missed-ternary, linq suggestions, etc.

# External data sources (for taint tracking)
# external-repository-token: ${{ secrets.GITHUB_TOKEN }}

# ML-powered alerts (experimental)
ml-powered-queries: true

# Trap caching for faster subsequent runs
trap-caching: true

# Build mode for compiled languages
# build-mode: 'manual' for custom build commands

# Additional configuration
packs:
  csharp:
    - codeql/csharp-queries
    - codeql/csharp-all

# Security policy
security-policy:
  # Severity levels to report
  minimum-severity: medium

  # Report on security findings
  fail-on-severity: high

  # License compliance
  check-licenses: true
