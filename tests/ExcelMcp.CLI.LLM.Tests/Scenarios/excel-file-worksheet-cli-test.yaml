# =============================================================================
# Excel File and Worksheet CLI Test - Realistic User Scenarios
# =============================================================================
#
# Tests: Natural user workflows for creating and organizing Excel workbooks
#
# Validates:
#   - LLM handles session workflow transparently (user doesn't manage sessions)
#   - LLM creates files, adds sheets, writes data, and saves correctly
#   - LLM uses quiet mode (-q) for clean JSON output
#
# Prerequisites:
#   - Windows 10/11 with Excel installed
#   - excelcli installed and in PATH (or use dotnet run)
#   - Environment: AZURE_OPENAI_ENDPOINT
#
# =============================================================================

criteria:
  success_rate: 1  # 100% required

ai_summary:
  enabled: true
  judge_provider: azure-openai-judge

providers:
  - name: azure-openai-gpt41
    type: AZURE
    auth_type: entra_id
    model: gpt-4.1
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
  - name: azure-openai-gpt5-chat
    type: AZURE
    auth_type: entra_id
    model: gpt-5.1-chat
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
  - name: azure-openai-judge
    type: AZURE
    auth_type: entra_id
    model: gpt-4.1
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview

servers:
  - name: excel-cli
    type: cli
    command: "{{CLI_COMMAND}}"
    shell: powershell
    working_dir: "{{TEMP_DIR}}"
    tool_prefix: excel

agents:
  - name: gpt41-agent
    servers:
      - name: excel-cli
    provider: azure-openai-gpt41
    skill:
      path: "{{SKILL_PATH_CLI}}"
      file_access: true
    clarification_detection:
      enabled: true
      judge_provider: azure-openai-judge
  - name: gpt5-chat-agent
    servers:
      - name: excel-cli
    provider: azure-openai-gpt5-chat
    skill:
      path: "{{SKILL_PATH_CLI}}"
      file_access: true
    clarification_detection:
      enabled: true
      judge_provider: azure-openai-judge

settings:
  verbose: true
  max_iterations: 15


sessions:
  # ==========================================================================
  # Create Budget Tracker with Multiple Sheets and Data
  # ==========================================================================
  - name: "Budget Tracker"
    tests:
      - name: "Create workbook with sheets and data"
        prompt: |
          Create a new Excel file at {{TEMP_DIR}}/budget-{{randomValue type='UUID'}}.xlsx

          Set it up with two sheets: Income and Expenses.

          On the Income sheet, add this data starting at A1:
          - Headers: Source, Amount
          - Salary: 5000
          - Freelance: 1200

          On the Expenses sheet, add:
          - Headers: Category, Amount
          - Rent: 1500
          - Utilities: 200
          - Food: 600

          Save the file when done.
        assertions:
          - type: no_clarification_questions
          - type: cli_exit_code_equals
            expected: 0
