# =============================================================================
# Chart Positioning CLI Test - Validates LLM Avoids Overlapping Data
# =============================================================================
#
# Purpose: Validates that LLMs properly position charts to avoid overlapping
# with existing data when using CLI commands.
#
# Prerequisites:
#   - Windows 10/11 with Excel installed
#   - excelcli installed or use dotnet run
#   - Environment: AZURE_OPENAI_ENDPOINT
#
# =============================================================================

criteria:
  success_rate: 1  # 100% required

ai_summary:
  enabled: true
  judge_provider: azure-openai-judge

providers:
  - name: azure-openai-gpt41
    type: AZURE
    auth_type: entra_id
    model: gpt-4.1
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
  - name: azure-openai-gpt5-chat
    type: AZURE
    auth_type: entra_id
    model: gpt-5.2-chat
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview
  - name: azure-openai-judge
    type: AZURE
    auth_type: entra_id
    model: gpt-4.1
    baseUrl: "{{AZURE_OPENAI_ENDPOINT}}"
    version: 2025-01-01-preview

servers:
  - name: excel-cli
    type: cli
    command: "{{CLI_COMMAND}}"
    shell: powershell
    working_dir: "{{TEMP_DIR}}"
    tool_prefix: excel

agents:
  - name: gpt41-agent
    servers:
      - name: excel-cli
    provider: azure-openai-gpt41
    skill:
      path: "{{SKILL_PATH_CLI}}"
      file_access: true
    clarification_detection:
      enabled: true
      judge_provider: azure-openai-judge
  - name: gpt5-chat-agent
    servers:
      - name: excel-cli
    provider: azure-openai-gpt5-chat
    skill:
      path: "{{SKILL_PATH_CLI}}"
      file_access: true
    clarification_detection:
      enabled: true
      judge_provider: azure-openai-judge

settings:
  verbose: true
  max_iterations: 15


sessions:
  # ==========================================================================
  # Session 1: Chart Position Below Data
  # ==========================================================================
  - name: "Chart Below Data"
    tests:
      - name: "Create chart positioned below data table"
        prompt: |
          1. Create a new empty Excel file at {{TEMP_DIR}}/llm-test-chart-pos-cli-{{randomValue type='UUID'}}.xlsx and open it
          2. Put sales data in A1:C6 on Sheet1:
             Row 1: Month, Revenue, Expenses
             Row 2: January, 50000, 35000
             Row 3: February, 55000, 38000
             Row 4: March, 48000, 32000
             Row 5: April, 62000, 41000
             Row 6: May, 58000, 39000
          3. Create a column chart from B1:C6 with Month labels from A1:A6
          4. Position the chart so it does NOT overlap with the data - it should be placed BELOW row 6
          5. List the charts and report the exact chart position 
          6. Save and close the file
        assertions:
          - type: cli_exit_code_equals
            expected: 0
          - type: no_clarification_questions
          - type: output_regex
            pattern: "(?i)(chart|created)"

  # ==========================================================================
  # Session 2: Chart Position Right of Table
  # ==========================================================================
  - name: "Chart Right of Table"
    tests:
      - name: "Create chart next to Excel Table without overlap"
        prompt: |
          1. Create a new empty Excel file at {{TEMP_DIR}}/llm-test-chart-table-cli-{{randomValue type='UUID'}}.xlsx and open it
          2. Put product data in A1:D5 on Sheet1:
             Row 1: Product, Q1, Q2, Q3
             Row 2: Widget, 100, 150, 120
             Row 3: Gadget, 80, 90, 110
             Row 4: Device, 200, 180, 220
             Row 5: Tool, 50, 60, 75
          3. Convert A1:D5 into an Excel Table named "ProductSales"
          4. Create a line chart from the table's numeric data (columns B:D)
          5. Position the chart to the RIGHT of the table so it doesn't overlap
          6. Save and close the file
        assertions:
          - type: cli_exit_code_equals
            expected: 0
          - type: no_clarification_questions
          - type: output_regex
            pattern: "(?i)(chart|created|productsales)"
